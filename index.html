<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OriLight</title>
    <meta name="description" content="OriLight">
    <meta name="keywords" content="OriLight,主页,HomePage">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3364945_px81la1x04b.css">
    <script async defer data-website-id="c2ca99a1-28d0-4303-b24b-7b3f21db02a8"
        src="https://analytics.amarea.cn/collect.js"></script>
    <script src="./config.js"></script>
</head>

<body>
    <div class="mask"></div>
    <div id="container">
        <div class="box clearfix">
            <div class="nav">
                <div class="nav-item nav-active"><a href="#info">INFO</a></div>
                <div class="nav-item"><a href="#about">ABOUT</a></div>
                <div class="nav-item"><a href="#post">POST</a></div>
                <div class="nav-item"><a href="#contact">CONTACT</a></div>
            </div>
            <div class="info card card-active">
                <div class="card-title"><span>INFO/信息</span></div>
                <p class="info-avatar"><img id="info-avatar"></p>
                <p class="info-name" id="info-title"></p>
                <p class="info-description" id="info-description"></p>
                <div class="link-container" id="link-container"></div>
                <div class="icon-container" id="icon-container"></div>
            </div>
            <div class="about card card-deactive" id="about">
                <div class="card-title">ABOUT/关于</div>
            </div>
            <div class="post card card-deactive">
                <div class="card-title">POST/文章</div>
                <div id="post-container"></div>
                <div class="post-more"><a href="" id="post-more">查看更多</a></div>
            </div>
            <div class="contact card card-deactive" id="contact">
                <div class="card-title">CONTACT/联系</div>
                <p>你可以通过下面的方式联系我</p>
            </div>
            <div class="footer">
                <p id="footer"></p>
            </div>
        </div>
    </div>
</body>
<script>
    window.onload = function () {
        let linkContainer = document.getElementById('link-container')
        let iconContainer = document.getElementById('icon-container')
        let aboutContainer = document.getElementById('about')
        let contactContainer = document.getElementById('contact')
        document.getElementById('info-avatar').src = config['avatar']
        document.getElementById('post-more').href = config['postMoreUrl']
        for (let node of config['textNode']) {
            document.getElementById(node['id']).textContent = node['text']
        }
        for (let link of config['links']) {
            let a = document.createElement('a')
            a.href = link['link']
            a.textContent = link['text']
            linkContainer.appendChild(a)
        }
        for (let icon of config['icons']) {
            let a = document.createElement('a')
            a.href = icon['link']
            a.title = icon['title']
            a.className = 'iconfont ' + icon['icon']
            iconContainer.appendChild(a)
        }
        for (let des of config['description']) {
            if (des['type'] == 'des') {
                let p = document.createElement('p')
                p.className = 'des'
                p.textContent = des['text']
                aboutContainer.appendChild(p)
            } else if (des['type'] == 'desf') {
                let p = document.createElement('p')
                p.className = 'des desf'
                p.textContent = des['text']
                aboutContainer.appendChild(p)
            } else if (des['type'] == 'dest') {
                let p = document.createElement('p')
                p.className = 'des dest'
                let tags = des['text'].split('/')
                for (let tag of tags) {
                    let t = document.createElement('span')
                    if (tag == tags[tags.length - 1]) t.innerHTML = (tag)
                    else t.innerHTML = (tag + "&nbsp;/&nbsp;")
                    p.appendChild(t)
                }
                aboutContainer.appendChild(p)
            } else if (des['type'] == 'desm') {
                let p = document.createElement('p')
                let a = document.createElement('a')
                let d = des['text'].split('@')
                p.className = 'more'
                a.href = d[1]
                a.innerHTML = d[0]
                p.appendChild(a)
                aboutContainer.appendChild(p)
            }
        }
        for (let con of config['contact']) {
            let p = document.createElement('p')
            let a = document.createElement('a')
            a.href = con['link']
            a.innerHTML = con['text']
            p.appendChild(a)
            contactContainer.appendChild(p)
        }
    }

    function changeNav(nav) {
        navList = document.getElementsByClassName('nav-item')
        cardList = document.getElementsByClassName('card')
        for (let item of cardList) {
            item.classList.remove('card-active')
        }
        for (let item of navList) {
            item.classList.remove('nav-active')
        }
        cardList[nav].classList.add('card-active')
        navList[nav].classList.add('nav-active')
    }
    hashListener = function () {
        switch (window.location.hash) {
            case '#info':
                changeNav(0)
                break
            case '#about':
                changeNav(1)
                break
            case '#post':
                changeNav(2)
                break
            case '#contact':
                changeNav(3)
                break
        }
    }
    window.addEventListener("hashchange", hashListener, false);
    async function getPost() {
        let apiUrl = config['postAPI']['url']
        let postContainer = document.getElementById('post-container')
        let response = await fetch(apiUrl)
        if (!response.ok || response.status != 200) {
            return 0
        }
        let result = await response.json()
        postContainer.innerHTML = ''
        for (let post of result['data']) {
            let div = document.createElement('div')
            let link = document.createElement('a')
            link.href = post['permalink']
            link.text = post['title']
            div.classList.add('post-item')
            div.appendChild(link)
            postContainer.appendChild(div)
        }
    }
    hashListener()
    getPost()
</script>

</html>